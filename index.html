<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>PDO4You by giovanniramos</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>PDO4You</h1>
        <p>PDO4You is a class that implements the Singleton design pattern for connecting the database using the PDO extension (PHP Data Objects)</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/giovanniramos/PDO4YOU" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/giovanniramos/PDO4YOU/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/giovanniramos/PDO4YOU/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <p><em><a href="https://github.com/giovanniramos/PDO4YOU/blob/master/README-pt.md">Leia a documentação em Português</a></em></p>

<hr><h1>
<a name="pdo4you" class="anchor" href="#pdo4you"><span class="octicon octicon-link"></span></a>PDO4You</h1>

<p>This class is based on the PDO, which is a PHP extension that allows developers to create portable code, so as to cater for most popular databases.
Being MySQL, PostgreSQL, SQLite, Oracle, Microsoft SQL Server, Sybase.</p>

<p>Alternatively been added in version 3.0 support for the MariaDB database.
MariaDB is being considered as the future replacement free of MySQL.
More information at: <a href="http://bit.ly/MARIADB">http://bit.ly/MARIADB</a></p>

<p>And since version 2.6 also has provided support for the CUBRID database.
A management system database highly optimized for Web applications.
More information at: <a href="http://bit.ly/CUBRID">http://bit.ly/CUBRID</a></p>

<p>The PDO4You provides an abstraction layer for data access, that regardless of which database you're using, you can always use the same methods to issue queries and fetch data.</p>

<p>The Singleton design pattern was adopted to optimize the connection, ensuring a single instance of the connection object.</p>

<p><strong>Advantages in use:</strong></p>

<ul>
<li>Abstraction of connection</li>
<li>Connection to database via VCAP_SERVICES</li>
<li>Protection against SQL Injection</li>
<li>CRUD methods predefined</li>
<li>Multiple database connections</li>
<li>SQL compact using JSON notation</li>
<li>Handling errors with Stack Trace</li>
</ul><h2>
<a name="loading-the-bootstrap-file" class="anchor" href="#loading-the-bootstrap-file"><span class="octicon octicon-link"></span></a>Loading the bootstrap file</h2>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Only one file is needed for loading the files responsible for the operation of the class.</span>
<span class="k">require_once</span><span class="p">(</span><span class="s1">'bootstrap.php'</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<p><code>PDO4You.class.php</code>: contains the implementation of the PDO object connection.</p>

<p><code>PDO4You.config.php</code>: initial configuration file, server access and database.</p>

<p><code>PDO4You.library.php</code>: file containing an autoloading class, and internal functions of the class.</p>

<p><code>PDO4You.settings.ini</code>: contains the settings for each adapter of connection to the database.</p>

<h2>
<a name="drivers-supported-by-the-server" class="anchor" href="#drivers-supported-by-the-server"><span class="octicon octicon-link"></span></a>Drivers supported by the server</h2>

<p>Execute the method below to check if the server supports a PDO driver specific to your database.
Supported drivers will be displayed on the screen.</p>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// The method below shows all the drivers installed and that are supported by the server</span>
<span class="nx">PDO4You</span><span class="o">::</span><span class="na">getAvailableDrivers</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<p>To enable any driver not installed, locate the php.ini file, open it and look for "extension=" without quotes, then uncomment the following lines according to your database preferably, removing the beginning of each line the "semicolon" and after changes, restart the server.</p>

<div class="highlight"><pre>;extension=php_pdo.dll                  ; This DLL is not required as of PHP 5.3
extension=php_pdo_mysql.dll             ; MySQL 3.x/4.x/5.x / MariaDB
extension=php_pdo_pgsql.dll             ; PostgreSQL
;extension=php_pdo_cubrid.dll           ; CUBRID
;extension=php_pdo_oci.dll              ; Oracle Call Interface
;extension=php_pdo_sqlsrv.dll           ; Microsoft SQL Server / SQL Azure
;extension=php_pdo_dblib.dll            ; Microsoft SQL Server / Sybase / FreeTDS
;extension=php_pdo_mssql.dll            ; Microsoft SQL Server "Old version"
;extension=php_pdo_sqlite.dll           ; SQLite 2/3

</pre></div>

<p>PDO drivers for the server Xampp:<br>
CUBRID (PHP 5.4): <a href="http://bit.ly/PDO_CUBRID-PHP54">http://bit.ly/PDO_CUBRID-PHP54</a><br>
CUBRID (PHP 5.3): <a href="http://bit.ly/PDO_CUBRID-PHP53">http://bit.ly/PDO_CUBRID-PHP53</a><br>
MS SQL Server 3.0 (PHP 5.4): <a href="http://bit.ly/PDO_SQLSRV-PHP54">http://bit.ly/PDO_SQLSRV-PHP54</a><br>
MS SQL Server 2.0 (PHP 5.2/5.3): <a href="http://bit.ly/PDO_SQLSRV-PHP53">http://bit.ly/PDO_SQLSRV-PHP53</a><br>
MS SQL Server (Old version): <a href="http://bit.ly/PDO_MSSQL-PHP53">http://bit.ly/PDO_MSSQL-PHP53</a></p>

<h2>
<a name="establishing-a-connection-to-the-database" class="anchor" href="#establishing-a-connection-to-the-database"><span class="octicon octicon-link"></span></a>Establishing a connection to the database</h2>

<p>To abstract our data access mechanisms, we use a DSN (Data Source Name = Data Source) that stores the information needed to initiate communication with other data sources, such as: type of technology, server name or location, database name, user, password, and other settings. This allows portability of the project, facilitating the exchange of access to the database during a migration.</p>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Main ways to start a connection instance</span>

<span class="c1"># DEFAULT </span>
<span class="nx">PDO4You</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span> <span class="c1">// The data access have been defined in the initial configuration</span>


<span class="c1">// Connecting to other data sources through a DSN</span>

<span class="c1"># MySQL / MariaDB</span>
<span class="nx">PDO4You</span><span class="o">::</span><span class="na">getInstance</span><span class="p">(</span><span class="s1">'instance_name'</span><span class="p">,</span> <span class="s1">'mysql:host=localhost;dbname=pdo4you;port=3306'</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">,</span> <span class="s1">'pass'</span><span class="p">);</span>

<span class="c1"># PostgreSQL</span>
<span class="nx">PDO4You</span><span class="o">::</span><span class="na">getInstance</span><span class="p">(</span><span class="s1">'instance_name'</span><span class="p">,</span> <span class="s1">'pgsql:host=localhost;dbname=pdo4you;port=5432'</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">,</span> <span class="s1">'pass'</span><span class="p">);</span>

<span class="c1"># CUBRID</span>
<span class="nx">PDO4You</span><span class="o">::</span><span class="na">getInstance</span><span class="p">(</span><span class="s1">'instance_name'</span><span class="p">,</span> <span class="s1">'cubrid:host=localhost;dbname=pdo4you;port=33000'</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">,</span> <span class="s1">'pass'</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<h2>
<a name="performing-crud-operations-on-your-database" class="anchor" href="#performing-crud-operations-on-your-database"><span class="octicon octicon-link"></span></a>Performing CRUD operations on your database</h2>

<p>The term CRUD refers to the 4 basic operations in a database and meaning:
Create(INSERT), Retrieve(SELECT), Update(UPDATE) e Destroy(DELETE)</p>

<p>Query statements:</p>

<p><code>PDO4You::select()</code>: returns an array indexed by column name.</p>

<p><code>PDO4You::selectNum()</code>: returns an array indexed by the numerical position of the column.</p>

<p><code>PDO4You::selectObj()</code>: returns an object with column names as properties.</p>

<p><code>PDO4You::selectAll()</code>: returns an array indexed by name and numerical position of the column.</p>

<p>Below are examples of how to perform these operations.</p>

<h2>
<a name="selecting-records-in-the-database" class="anchor" href="#selecting-records-in-the-database"><span class="octicon octicon-link"></span></a>Selecting records in the database</h2>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Starting a connection instance. The default connection is not persistent</span>
<span class="nx">PDO4You</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>

<span class="c1">// Defining a persistent communication with the database</span>
<span class="nx">PDO4You</span><span class="o">::</span><span class="na">setPersistent</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

<span class="c1">// Selecting records in the database</span>
<span class="nx">PDO4You</span><span class="o">::</span><span class="na">select</span><span class="p">(</span><span class="s1">'SELECT * FROM books LIMIT 2'</span><span class="p">);</span>

<span class="c1">// Selecting records and setting that connection instance will be used</span>
<span class="nx">PDO4You</span><span class="o">::</span><span class="na">select</span><span class="p">(</span><span class="s1">'SELECT * FROM books LIMIT 2'</span><span class="p">,</span> <span class="s1">'instance_name'</span><span class="p">);</span>


<span class="c1">// Query statement</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="s1">'SELECT * FROM books LIMIT 2'</span><span class="p">;</span>

<span class="c1">// Selecting records with PDO::FETCH_ASSOC</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">PDO4You</span><span class="o">::</span><span class="na">select</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// Selecting records with PDO::FETCH_NUM</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">PDO4You</span><span class="o">::</span><span class="na">selectNum</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// Selecting records with PDO::FETCH_OBJ</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">PDO4You</span><span class="o">::</span><span class="na">selectObj</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// Selecting records with PDO::FETCH_BOTH</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">PDO4You</span><span class="o">::</span><span class="na">selectAll</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>


<span class="c1">// Selecting all records</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">PDO4You</span><span class="o">::</span><span class="na">select</span><span class="p">(</span><span class="s1">'SELECT * FROM books'</span><span class="p">);</span>

<span class="c1">// Getting the total number of rows affected by the operation</span>
<span class="nv">$total</span> <span class="o">=</span> <span class="nx">PDO4You</span><span class="o">::</span><span class="na">rowCount</span><span class="p">();</span>

<span class="c1">// Displaying the query results</span>
<span class="k">echo</span> <span class="s1">'&lt;pre&gt;&lt;h3&gt;Query Result:&lt;/h3&gt; '</span> <span class="p">,</span> <span class="nb">print_r</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span> <span class="p">,</span> <span class="s1">'&lt;/pre&gt;'</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<p>The methods insert(), update() and delete() of the PDO4You class, are nestled between transactions, these being beginTransaction() and commit(). This ensures that the system can roll back an unsuccessful operation and all changes made ​​since the start of a transaction.</p>

<p>Was added in version 3.1 the execute() method, as an alternative to methods (insert, update and delete).</p>

<p>A serious error in the execution results in invoke rollBack(), undoing the whole operation. Consequently one Exception is thrown, tracing the path of all classes and methods involved in the operation, speeding in an environment of "production", the debug process and thus ensuring the database of the risk becoming unstable.</p>

<p>In MySQL, transaction support is available for InnoDB type tables.</p>

<p>The SQL statements of the PDO4You class (insert, update and delete) are now using JSON notation, a new format to write queries which in turn has conventions very similar to languages ​​like Python, Ruby, C++, Java, JavaScript. The new syntax adopted by the class is much more beautiful and concise, than the used by Arrays. Besides compact, instructions are capable of operating simultaneously in different tables in the same database.</p>

<p>Below are excerpts from example in practice.</p>

<h2>
<a name="inserting-a-single-row-in-the-database" class="anchor" href="#inserting-a-single-row-in-the-database"><span class="octicon octicon-link"></span></a>Inserting a single row in the database</h2>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// SQL insert in JSON format</span>
<span class="nv">$json</span> <span class="o">=</span> <span class="s1">'</span>
<span class="s1">    insert : [</span>
<span class="s1">        {</span>
<span class="s1">            table: "users" ,</span>
<span class="s1">            values: { mail: "pdo4you@gmail.com" }</span>
<span class="s1">        }</span>
<span class="s1">    ] </span>
<span class="s1">'</span><span class="p">;</span>

<span class="c1">// The $result variable stores as return of the method, an array with the number of rows affected by the insert operation</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">PDO4You</span><span class="o">::</span><span class="na">execute</span><span class="p">(</span><span class="nv">$json</span><span class="p">);</span>

<span class="c1">// Just after insertion, use the method PDO4You::lastId() to get the ID of the last insert operation in the database</span>
<span class="nv">$lastInsertId</span> <span class="o">=</span> <span class="nx">PDO4You</span><span class="o">::</span><span class="na">lastId</span><span class="p">();</span>

<span class="c1">// If needed, enter the name of the sequence variable, required in some databases</span>
<span class="nv">$lastInsertId</span> <span class="o">=</span> <span class="nx">PDO4You</span><span class="o">::</span><span class="na">lastId</span><span class="p">(</span><span class="s1">'table_id_seq'</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<h2>
<a name="inserting-multiple-records" class="anchor" href="#inserting-multiple-records"><span class="octicon octicon-link"></span></a>Inserting multiple records</h2>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// SQL insert in JSON format</span>
<span class="nv">$json</span> <span class="o">=</span> <span class="s1">'</span>
<span class="s1">    insert : [</span>
<span class="s1">        {</span>
<span class="s1">            table: "users" ,</span>
<span class="s1">            values: { mail: "mail_1@domain.com" }</span>
<span class="s1">        },{</span>
<span class="s1">            table: "users" ,</span>
<span class="s1">            values: { mail: "mail_2@domain.com" }</span>
<span class="s1">        },{</span>
<span class="s1">            table: "books" ,</span>
<span class="s1">            values: { title: "title", author: "author" }</span>
<span class="s1">        }</span>
<span class="s1">    ] </span>
<span class="s1">'</span><span class="p">;</span>

<span class="c1">// The $result variable stores an array with the number of rows affected by the insert operation</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">PDO4You</span><span class="o">::</span><span class="na">execute</span><span class="p">(</span><span class="nv">$json</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<h2>
<a name="updating-multiple-records" class="anchor" href="#updating-multiple-records"><span class="octicon octicon-link"></span></a>Updating multiple records</h2>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// SQL update in JSON format</span>
<span class="nv">$json</span> <span class="o">=</span> <span class="s1">'</span>
<span class="s1">    update : [</span>
<span class="s1">        {</span>
<span class="s1">            table: "users" ,</span>
<span class="s1">            values: { mail: "mail_1@domain.com" } ,</span>
<span class="s1">            where: { id: 2 }</span>
<span class="s1">        },{</span>
<span class="s1">            table: "users" ,</span>
<span class="s1">            values: { mail: "mail_2@domain.com" } ,</span>
<span class="s1">            where: { id: 3 }</span>
<span class="s1">        },{</span>
<span class="s1">            table: "books" ,</span>
<span class="s1">            values: { title: "new-title", author: "new-author" } ,</span>
<span class="s1">            where: { id: 1 }</span>
<span class="s1">        }</span>
<span class="s1">    ] </span>
<span class="s1">'</span><span class="p">;</span>

<span class="c1">// The $result variable stores an array with the number of rows affected by the update operation</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">PDO4You</span><span class="o">::</span><span class="na">execute</span><span class="p">(</span><span class="nv">$json</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<h2>
<a name="deleting-multiple-records" class="anchor" href="#deleting-multiple-records"><span class="octicon octicon-link"></span></a>Deleting multiple records</h2>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// SQL delete in JSON format</span>
<span class="nv">$json</span> <span class="o">=</span> <span class="s1">'</span>
<span class="s1">    delete : [</span>
<span class="s1">        {</span>
<span class="s1">            table: "users" ,</span>
<span class="s1">            where: { id: 2 }</span>
<span class="s1">        },{</span>
<span class="s1">            table: "users" ,</span>
<span class="s1">            where: { id: 5 }</span>
<span class="s1">        },{</span>
<span class="s1">            table: "users" ,</span>
<span class="s1">            where: { id: 10 }</span>
<span class="s1">        },{</span>
<span class="s1">            table: "books" ,</span>
<span class="s1">            where: { id: 10 }</span>
<span class="s1">        }</span>
<span class="s1">    ] </span>
<span class="s1">'</span><span class="p">;</span>

<span class="c1">// The $result variable stores an array with the number of rows affected by the delete operation</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">PDO4You</span><span class="o">::</span><span class="na">execute</span><span class="p">(</span><span class="nv">$json</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<h2>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h2>

<p>PHP 5.3 or higher</p>

<h2>
<a name="collaborators" class="anchor" href="#collaborators"><span class="octicon octicon-link"></span></a>Collaborators</h2>

<p>Giovanni Ramos - <a href="mailto:giovannilauro@gmail.com">giovannilauro@gmail.com</a> - <a href="http://twitter.com/giovanni_ramos">http://twitter.com/giovanni_ramos</a><br>
See also the list of <a href="https://github.com/giovanniramos/PDO4YOU/contributors">colaboradores</a> who participated in this project.</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>PDO4You is licensed under the <a href="http://opensource.org/licenses/gpl-3.0.html">GNU General Public License, version 3 (GPL-3.0)</a> </p>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/giovanniramos">giovanniramos</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-5376735-7");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>